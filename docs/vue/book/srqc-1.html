<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      ã€æ·±å…¥æµ…å‡º Vue.jsã€‘Object çš„å˜åŒ–ä¾¦æµ‹ | Nirvana
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/nirvana/_assets/style.b16d0605.css">
    <link rel="modulepreload" href="/nirvana/_assets/common-874b6af4.js">
    <link rel="modulepreload" href="/nirvana/_assets/docs_vue_book_srqc-1.md.e66ab639.lean.js">
    <link rel="modulepreload" href="/nirvana/_assets/app.963d3ba1.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="keywords" content="Jeamn">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
    <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
    <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
    
  </head>
  <body>
    <div id="app"><!--[--><div id="containerColor" class="no-sidebar theme" data-v-4a5ae416><header class="navbar" data-v-4a5ae416><!--[--><a class="title" aria-label="Nirvana, back to home" href="/nirvana/"><img class="logo" src="/nirvana/favicon.ico" alt="logo"><span>Nirvana</span></a><div class="flex-grow"></div><nav class="nav-links hide-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/index.html" target="" rel="">ğŸ  é¦–é¡µ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><!--]--><div class="sidebar-button" data-v-4a5ae416><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div></header><aside class="" data-v-4a5ae416><!--[--><nav class="nav-links show-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/index.html" target="" rel="">ğŸ  é¦–é¡µ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar"><!--[--><!--]--></ul><!--[--><!--]--><!--]--></aside><!----><!-- TODO: make this button accessible --><div class="sidebar-mask" data-v-4a5ae416></div><main data-v-4a5ae416><!--[--><div class="content"><!--[--><!--]--><div class="md-header"><div class="md-title">ã€æ·±å…¥æµ…å‡º Vue.jsã€‘Object çš„å˜åŒ–ä¾¦æµ‹</div><span id="jinrishici-sentence">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span><div class="md-date">2022-03-26T00:00:00.000Z</div></div><ul class="catalog"><!--[--><li class="catalog-item"><a class="level level-2" href="#ä¸€ã€å˜åŒ–ä¾¦æµ‹">ä¸€ã€å˜åŒ–ä¾¦æµ‹</a><!----></li><li class="catalog-item"><a class="level level-2" href="#äºŒã€å¦‚ä½•è¿½è¸ªå˜åŒ–">äºŒã€å¦‚ä½•è¿½è¸ªå˜åŒ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¸‰ã€å¦‚ä½•æ”¶é›†ä¾èµ–">ä¸‰ã€å¦‚ä½•æ”¶é›†ä¾èµ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å››ã€ä¾èµ–æ”¶é›†åœ¨å“ªé‡Œ">å››ã€ä¾èµ–æ”¶é›†åœ¨å“ªé‡Œ</a><!----></li><li class="catalog-item"><a class="level level-2" href="#äº”ã€ä¾èµ–æ˜¯è°">äº”ã€ä¾èµ–æ˜¯è°</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å…­ã€ä»€ä¹ˆæ˜¯-watcher">å…­ã€ä»€ä¹ˆæ˜¯ Watcher</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¸ƒã€é€’å½’ä¾¦æµ‹æ‰€æœ‰-key">ä¸ƒã€é€’å½’ä¾¦æµ‹æ‰€æœ‰ key</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å…«ã€å…³äº-object-çš„é—®é¢˜">å…«ã€å…³äº Object çš„é—®é¢˜</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¹ã€æ€»ç»“">ä¹ã€æ€»ç»“</a><!----></li><!--]--></ul><div><h2 id="ä¸€ã€å˜åŒ–ä¾¦æµ‹"><a class="header-anchor" href="#ä¸€ã€å˜åŒ–ä¾¦æµ‹" aria-hidden="true">#</a> ä¸€ã€å˜åŒ–ä¾¦æµ‹</h2><p>å˜åŒ–ä¾¦æµ‹æœ‰ä¸¤ç§ç±»å‹ï¼šâ€æ¨â€œå’Œâ€æ‹‰â€œã€‚</p><p>â€œæ‹‰â€æŒ‡çš„æ˜¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ¡†æ¶ä¸çŸ¥é“å“ªä¸ªçŠ¶æ€å˜äº†ï¼Œéœ€è¦é€šè¿‡æš´åŠ›å¯¹æ¯”å»æ‰¾å‡ºå˜åŒ–çš„ DOM èŠ‚ç‚¹ã€‚React å’Œ Angular å°±æ˜¯è¿™ç§ä¾¦æµ‹æ–¹å¼ï¼Œåˆ†åˆ«é‡‡ç”¨è™šæ‹Ÿ DOM æŠ€æœ¯å’Œè„æ£€æŸ¥ã€‚</p><p>â€æ¨â€œæŒ‡çš„æ˜¯æŒ‡çš„æ˜¯çŠ¶æ€å˜åŒ–èƒ½ç«‹é©¬çŸ¥é“ï¼ŒVue å°±æ˜¯å±äºè¿™ç§ï¼Œå› æ­¤ Vue èƒ½è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ›´æ–°ã€‚</p><blockquote><p>ç»†ç²’åº¦æŒ‡çš„æ˜¯å‡å¦‚ä¸€ä¸ªçŠ¶æ€ç»‘å®šç€å¥½å¤šä¸ªä¾èµ–ï¼Œæ¯ä¸ªä¾èµ–ä»£è¡¨ä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“è¿™ä¸ªçŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘è¿™ä¸ªçŠ¶æ€çš„æ‰€æœ‰ä¾èµ–å‘é€é€šçŸ¥ï¼Œè®©å®ƒä»¬è¿›è¡ŒDOMæ›´æ–°æ“ä½œã€‚</p></blockquote><p>ç²’åº¦å¤ªç»†ï¼Œå½“çŠ¶æ€å¤šçš„æƒ…å†µä¸‹ï¼Œä¾èµ–è¿½è¸ªåœ¨å†…å­˜ä¸Šçš„å¼€é”€ä¼šå¾ˆå¤§ã€‚æ‰€ä»¥ Vue2.0 å¼•å…¥äº†è™šæ‹Ÿ DOMï¼Œå°†ç²’åº¦è°ƒæ•´ä¸ºä¸­ç­‰ç²’åº¦ï¼Œå³ä¸€ä¸ªçŠ¶æ€æ‰€ç»‘å®šçš„ä¾èµ–ä¸å†æ˜¯ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªç»„ä»¶ã€‚çŠ¶æ€çš„å˜åŒ–ä¼šå…ˆé€šçŸ¥åˆ°ç»„ä»¶ï¼Œç»„ä»¶å†…éƒ¨å†ä½¿ç”¨è™šæ‹Ÿ DOM è¿›è¡Œæ¯”å¯¹ã€‚</p><h2 id="äºŒã€å¦‚ä½•è¿½è¸ªå˜åŒ–"><a class="header-anchor" href="#äºŒã€å¦‚ä½•è¿½è¸ªå˜åŒ–" aria-hidden="true">#</a> äºŒã€å¦‚ä½•è¿½è¸ªå˜åŒ–</h2><p>å˜åŒ–ä¾¦æµ‹æœ‰ä¸¤ç§æ–¹å¼ï¼šObject.defineProperty å’Œ ES6 çš„ Proxy</p><p>ä¸‹é¢å®šä¹‰ä¸€ä¸ªå“åº”å¼çš„æ–¹æ³•ï¼š</p><div class="language-jsx"><pre><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Obejct<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span>
			val <span class="token operator">=</span> newVal
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¸‰ã€å¦‚ä½•æ”¶é›†ä¾èµ–"><a class="header-anchor" href="#ä¸‰ã€å¦‚ä½•æ”¶é›†ä¾èµ–" aria-hidden="true">#</a> ä¸‰ã€å¦‚ä½•æ”¶é›†ä¾èµ–</h2><p>åœ¨ getter ä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨ setter ä¸­è§¦å‘ä¾èµ–ã€‚</p><h2 id="å››ã€ä¾èµ–æ”¶é›†åœ¨å“ªé‡Œ"><a class="header-anchor" href="#å››ã€ä¾èµ–æ”¶é›†åœ¨å“ªé‡Œ" aria-hidden="true">#</a> å››ã€ä¾èµ–æ”¶é›†åœ¨å“ªé‡Œ</h2><p>æ¯ä¸ª key éƒ½æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨å½“å‰ key çš„ä¾èµ–ã€‚å‡è®¾æœ‰ä¸€ä¸ªä¾èµ–ï¼Œå­˜å‚¨åœ¨ <a href="http://window.target" target="_blank" rel="noopener noreferrer">window.target</a> ä¸Šï¼Œ</p><div class="language-jsx"><pre><code><span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// æ–°å¢</span>
<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Obejct<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			dep<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token comment">// æ–°å¢ï¼Œå­˜å‚¨ä¾èµ–</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span>
		  <span class="token comment">// æ–°å¢ï¼Œè§¦å‘ä¾èµ–</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dep<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				dep<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			val <span class="token operator">=</span> newVal
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ª Dep ç±»æ¥ç®¡ç†ä¾èµ–ï¼Œå®ç°ä¾èµ–æ”¶é›†ã€åˆ é™¤ã€å‘ä¾èµ–å‘é€é€šçŸ¥ï¼š</p><div class="language-jsx"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>

  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-jsx"><pre><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿®æ”¹</span>
	Obejct<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿®æ”¹ï¼Œå­˜å‚¨ä¾èµ–</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span>
			dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ä¿®æ”¹</span>
			val <span class="token operator">=</span> newVal
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="äº”ã€ä¾èµ–æ˜¯è°"><a class="header-anchor" href="#äº”ã€ä¾èµ–æ˜¯è°" aria-hidden="true">#</a> äº”ã€ä¾èµ–æ˜¯è°</h2><p>ä¸Šé¢æˆ‘ä»¬æ”¶é›†çš„ä¾èµ–æ˜¯ window.targetï¼Œå…¶å®å°±æ˜¯å½“å±æ€§å‘ç”Ÿå˜åŒ–åè¦é€šçŸ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¸ºä¾èµ–ã€‚</p><p>ä¾èµ–ä¹Ÿå¯èƒ½æœ‰å¾ˆå¤šç§å½¢å¼ï¼Œæ¨¡æ¿ã€ç”¨æˆ·å†™çš„ä¸€ä¸ªwatch...æ‰€ä»¥éœ€è¦ä¸€ä¸ªé›†ä¸­å¤„ç†è¿™äº›æƒ…å†µçš„ç±»ã€‚</p><p>æˆ‘ä»¬åœ¨ä¾èµ–æ”¶é›†é˜¶æ®µåªæ”¶é›†è¿™ä¸ªç±»çš„å®ä¾‹ï¼Œé€šçŸ¥ä¹Ÿåªé€šçŸ¥å®ƒï¼Œç„¶åå®ƒå†å»é€šçŸ¥å…¶ä»–åœ°æ–¹ã€‚å®ƒå«Watcherï¼ï¼ï¼</p><h2 id="å…­ã€ä»€ä¹ˆæ˜¯-watcher"><a class="header-anchor" href="#å…­ã€ä»€ä¹ˆæ˜¯-watcher" aria-hidden="true">#</a> å…­ã€ä»€ä¹ˆæ˜¯ Watcher</h2><p>ç±»ä¼¼äºä¸€ä¸ªä¸­ä»‹ï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥å®ƒï¼Œå®ƒå†é€šçŸ¥å…¶ä»–åœ°æ–¹ã€‚</p><h2 id="ä¸ƒã€é€’å½’ä¾¦æµ‹æ‰€æœ‰-key"><a class="header-anchor" href="#ä¸ƒã€é€’å½’ä¾¦æµ‹æ‰€æœ‰-key" aria-hidden="true">#</a> ä¸ƒã€é€’å½’ä¾¦æµ‹æ‰€æœ‰ key</h2><p>ä¸ºäº†ä¾¦æµ‹æ•°æ®ä¸­çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬å­å±æ€§ï¼‰ï¼Œéœ€è¦å°è£…ä¸€ä¸ª Observer ç±»ã€‚</p><p>è¿™ä¸ªç±»çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ•°æ®å†…çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬å­å±æ€§ï¼‰éƒ½è½¬æ¢æˆ getter/setter çš„å½¢å¼ï¼Œæ¥æ”¶é›†å±æ€§çš„ä¾èµ–ï¼Œå¹¶ä¸”å½“å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ä¼šé€šçŸ¥è¿™äº›ä¾èµ–ã€‚</p><div class="language-jsx"><pre><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> 
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//	æ–°å¢ï¼Œé€’å½’å­å±æ€§</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
  <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	Obejct<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span>
			dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			val <span class="token operator">=</span> newVal
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å…«ã€å…³äº-object-çš„é—®é¢˜"><a class="header-anchor" href="#å…«ã€å…³äº-object-çš„é—®é¢˜" aria-hidden="true">#</a> å…«ã€å…³äº Object çš„é—®é¢˜</h2><p>å‘ obj å¯¹è±¡æ–°å¢å±æ€§æˆ–è€…åˆ é™¤å±æ€§ï¼ŒVue.js æ— æ³•ä¾¦æµ‹åˆ°è¿™ä¸ªå˜åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šå‘ä¾èµ–å‘é€é€šçŸ¥ã€‚</p><blockquote><p>getter/setter åªèƒ½è¿½è¸ªä¸€ä¸ªæ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œæ— æ³•è¿½è¸ªæ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§ã€‚å› ä¸º js æ²¡æœ‰æä¾›å…ƒç¼–ç¨‹çš„èƒ½åŠ›ã€‚æ‰€ä»¥ Vue æä¾›äº†ä¸¤ä¸ª API â€”â€” vm.$set å’Œ vm.$deleteã€‚</p></blockquote><h2 id="ä¹ã€æ€»ç»“"><a class="header-anchor" href="#ä¹ã€æ€»ç»“" aria-hidden="true">#</a> ä¹ã€æ€»ç»“</h2><ol><li>Object å¯ä»¥é€šè¿‡ defineProperty å°†å±æ€§è½¬æ¢æˆ getter/setter çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–ï¼Œè¯»å–æ—¶è§¦å‘ getterï¼Œä¿®æ”¹æ•°æ®æ—¶è§¦å‘ setterï¼›</li><li>æˆ‘ä»¬éœ€è¦åœ¨ getter ä¸­æ”¶é›†æœ‰å“ªäº›ä¾èµ–ä½¿ç”¨äº†è¯¥æ•°æ®ï¼Œå½“ setter è§¦å‘æ—¶ï¼Œå»é€šçŸ¥ getter ä¸­æ”¶é›†çš„ä¾èµ–æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼›</li><li>æˆ‘ä»¬åˆ›å»ºäº† Dep æ¥æ”¶é›†ä¾èµ–ã€åˆ é™¤ä¾èµ–å’Œå‘ä¾èµ–å‘é€æ¶ˆæ¯ç­‰ï¼›</li><li>ä¾èµ–å…¶å®å°±æ˜¯ Watcherï¼Œåªæœ‰ Watcher è§¦å‘çš„ getter æ‰ä¼šæ”¶é›†ä¾èµ–ï¼Œå“ªä¸ª Watcher è§¦å‘äº† getterï¼Œå°±æŠŠå“ªä¸ª Watcher æ”¶é›†åˆ° Dep ä¸­ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¾ªç¯ä¾èµ–åˆ—è¡¨ï¼ŒæŠŠæ‰€æœ‰ Watcher é€šçŸ¥ä¸€éï¼›</li><li>Watcher çš„åŸç†æ˜¯å…ˆæŠŠè‡ªå·±è®¾ç½®åˆ°å…¨å±€å”¯ä¸€çš„æŒ‡å®šä½ç½®ï¼ˆä¾‹å¦‚ window.targetï¼‰ï¼Œç„¶åè¯»å–æ•°æ®ã€‚å› ä¸ºè¯»å–äº†æ•°æ®ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¿™ä¸ªæ•°æ®çš„ getterã€‚æ¥ç€åœ¨ getter ä¸­å°±ä¼šä»å…¨å±€å”¯ä¸€çš„é‚£ä¸ªä½ç½®è¯»å–å½“å‰æ­£åœ¨è¯»å–æ•°æ®çš„ Watcherï¼Œå¹¶æŠŠè¿™ä¸ª Watcher æ”¶é›†åˆ° Dep ä¸­å»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ Watcher å¯ä»¥ä¸»åŠ¨è®¢é˜…ä»»æ„ä¸€ä¸ªæ•°æ®çš„å˜åŒ–ï¼›</li><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Observer ç±»ï¼ŒæŠŠä¸€ä¸ª object ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è½¬æ¢æˆå“åº”å¼çš„ã€‚</li></ol><p><img src="/nirvana/_assets/srqc-1.109c3155.png" alt=""></p><ul><li>Data é€šè¿‡ Observer è½¬æ¢æˆäº† getter/setter çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–ã€‚</li><li>å½“å¤–ç•Œé€šè¿‡ Watcher è¯»å–æ•°æ®æ—¶ï¼Œä¼šè§¦å‘ getter ä»è€Œå°† Watcher æ·»åŠ åˆ°ä¾èµ– Dep ä¸­ã€‚</li><li>å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘ setterï¼Œä»è€Œå‘ Dep ä¸­çš„ä¾èµ–å‘é€é€šçŸ¥ã€‚</li><li>Watcher æ¥æ”¶åˆ°é€šçŸ¥åï¼Œä¼šå‘å¤–ç•Œå‘é€é€šçŸ¥ï¼Œå˜åŒ–é€šçŸ¥åˆ°å¤–ç•Œåè§¦å‘è§†å›¾æ›´æ–°ï¼Œä¹Ÿæœ‰å¯èƒ½è§¦å‘ç”¨æˆ·çš„æŸä¸ªå›è°ƒå‡½æ•°ã€‚</li></ul></div><div class="links-wrapper"><div class="prev-link"><!----></div><div class="next-link"><!----></div></div><div><p class="platform"> Copyright Â© 2022-2023 <a href="https://github.com/jeamn">@Jeamn</a></p></div><!--[--><!--]--></div><!-- åªæƒ³ç‚¹å‡»èƒŒæ™¯æ‰å…³é—­ è¯·ä½¿ç”¨ .self ä¿®é¥°ç¬¦ --><div style="display:none;" class="imgBox"><img src=""></div><!--]--></main><div class="theme-select" data-v-4a5ae416><ul data-v-4a5ae416><li class="active" data-v-4a5ae416>â˜€ï¸</li><li class="" data-v-4a5ae416>ğŸŒ‘</li></ul></div></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"README.md\":\"74ba73cf\",\"index.md\":\"c2842757\",\"more_Friendship.md\":\"2ddbc272\",\"more_docs.md\":\"ac4de4a9\",\"more_index.md\":\"2f258ce2\",\"more_tags.md\":\"9c361e7d\",\"docs_algorithm_monotonic-stack.md\":\"06425485\",\"docs_browser_cookie.md\":\"8cbcb41a\",\"docs_browser_rendering.md\":\"8f638c6b\",\"docs_javascript_anti-shaking-and-throttling.md\":\"9af40163\",\"docs_javascript_bind.md\":\"0e4d9cea\",\"docs_javascript_closure.md\":\"9c603236\",\"docs_javascript_es6-Iterator.md\":\"942ac03c\",\"docs_javascript_es6-Promise.md\":\"56c7c057\",\"docs_javascript_es6-module.md\":\"0b7596e3\",\"docs_javascript_event-loop.md\":\"9969f462\",\"docs_javascript_inherit.md\":\"7889c76a\",\"docs_javascript_scope.md\":\"15bb219e\",\"docs_node_realize-require.md\":\"3830c2f9\",\"docs_vue_interview.md\":\"005b29bf\",\"docs_vue_vue-array-update.md\":\"041757dc\",\"docs_vue_vue-bind.md\":\"6fc818cf\",\"docs_vue_book_srqc-1.md\":\"e66ab639\",\"docs_vue_book_srqc-10.md\":\"b56c32c7\",\"docs_vue_book_srqc-2.md\":\"4e783021\",\"docs_vue_book_srqc-3.md\":\"028c7b9d\",\"docs_vue_book_srqc-4.md\":\"74007c18\",\"docs_vue_book_srqc-5.md\":\"d3152f32\",\"docs_vue_book_srqc-6.md\":\"f53289b5\",\"docs_vue_book_srqc-7.md\":\"b6d0a962\",\"docs_vue_book_srqc-8.md\":\"95cb9979\",\"docs_vue_book_srqc-9.md\":\"2a093e51\"}")</script>
    <script type="module" async src="/nirvana/_assets/app.963d3ba1.js"></script>
  </body>
</html>