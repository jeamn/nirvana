<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      ã€æ·±å…¥æµ…å‡º Vue.jsã€‘Array çš„å˜åŒ–ä¾¦æµ‹ | Nirvana
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/nirvana/_assets/style.b16d0605.css">
    <link rel="modulepreload" href="/nirvana/_assets/common-874b6af4.js">
    <link rel="modulepreload" href="/nirvana/_assets/docs_vue_book_srqc-2.md.4e783021.lean.js">
    <link rel="modulepreload" href="/nirvana/_assets/app.963d3ba1.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="keywords" content="Jeamn">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
    <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
    <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
    
  </head>
  <body>
    <div id="app"><!--[--><div id="containerColor" class="no-sidebar theme" data-v-4a5ae416><header class="navbar" data-v-4a5ae416><!--[--><a class="title" aria-label="Nirvana, back to home" href="/nirvana/"><img class="logo" src="/nirvana/favicon.ico" alt="logo"><span>Nirvana</span></a><div class="flex-grow"></div><nav class="nav-links hide-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/index.html" target="" rel="">ğŸ  é¦–é¡µ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><!--]--><div class="sidebar-button" data-v-4a5ae416><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div></header><aside class="" data-v-4a5ae416><!--[--><nav class="nav-links show-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/index.html" target="" rel="">ğŸ  é¦–é¡µ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/nirvana/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar"><!--[--><!--]--></ul><!--[--><!--]--><!--]--></aside><!----><!-- TODO: make this button accessible --><div class="sidebar-mask" data-v-4a5ae416></div><main data-v-4a5ae416><!--[--><div class="content"><!--[--><!--]--><div class="md-header"><div class="md-title">ã€æ·±å…¥æµ…å‡º Vue.jsã€‘Array çš„å˜åŒ–ä¾¦æµ‹</div><span id="jinrishici-sentence">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span><div class="md-date">2022-03-28T00:00:00.000Z</div></div><ul class="catalog"><!--[--><li class="catalog-item"><a class="level level-2" href="#ä¸€ã€å¦‚ä½•è¿½è¸ªå˜åŒ–">ä¸€ã€å¦‚ä½•è¿½è¸ªå˜åŒ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#äºŒã€æ‹¦æˆªå™¨">äºŒã€æ‹¦æˆªå™¨</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¸‰ã€ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–-array-åŸå‹">ä¸‰ã€ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›– Array åŸå‹</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å››ã€å°†æ‹¦æˆªå™¨æ–¹æ³•æŒ‚è½½åˆ°æ•°ç»„çš„å±æ€§ä¸Š">å››ã€å°†æ‹¦æˆªå™¨æ–¹æ³•æŒ‚è½½åˆ°æ•°ç»„çš„å±æ€§ä¸Š</a><!----></li><li class="catalog-item"><a class="level level-2" href="#äº”ã€å¦‚ä½•æ”¶é›†ä¾èµ–">äº”ã€å¦‚ä½•æ”¶é›†ä¾èµ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å…­ã€ä¾èµ–åˆ—è¡¨å­˜åœ¨å“ªå„¿">å…­ã€ä¾èµ–åˆ—è¡¨å­˜åœ¨å“ªå„¿</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¸ƒã€æ”¶é›†ä¾èµ–">ä¸ƒã€æ”¶é›†ä¾èµ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#å…«ã€åœ¨æ‹¦æˆªå™¨ä¸­è·å–-observer-å®ä¾‹">å…«ã€åœ¨æ‹¦æˆªå™¨ä¸­è·å– Observer å®ä¾‹</a><!----></li><li class="catalog-item"><a class="level level-2" href="#ä¹ã€å‘æ•°ç»„çš„ä¾èµ–å‘é€é€šçŸ¥">ä¹ã€å‘æ•°ç»„çš„ä¾èµ–å‘é€é€šçŸ¥</a><!----></li><li class="catalog-item"><a class="level level-2" href="#åã€ä¾¦æµ‹æ•°ç»„ä¸­å…ƒç´ çš„å˜åŒ–">åã€ä¾¦æµ‹æ•°ç»„ä¸­å…ƒç´ çš„å˜åŒ–</a><!----></li><li class="catalog-item"><a class="level level-2" href="#åä¸€ã€ä¾¦æµ‹æ–°å¢å…ƒç´ çš„å˜åŒ–">åä¸€ã€ä¾¦æµ‹æ–°å¢å…ƒç´ çš„å˜åŒ–</a><!----></li><!--]--></ul><div><h2 id="ä¸€ã€å¦‚ä½•è¿½è¸ªå˜åŒ–"><a class="header-anchor" href="#ä¸€ã€å¦‚ä½•è¿½è¸ªå˜åŒ–" aria-hidden="true">#</a> ä¸€ã€å¦‚ä½•è¿½è¸ªå˜åŒ–</h2><p>æƒ³è¦è¿½è¸ªæ•°ç»„çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ‹¦æˆªå™¨è¦†ç›– Array.prototypeï¼Œé‚£ä¹ˆæ¯å½“ä½¿ç”¨ Array åŸå‹ä¸Šçš„æ–¹æ³•æ“ä½œæ•°ç»„æ—¶ï¼Œå…¶å®æ‰§è¡Œçš„éƒ½æ˜¯æ‹¦æˆªå™¨ä¸­çš„æä¾›çš„æ–¹æ³•ã€‚</p><h2 id="äºŒã€æ‹¦æˆªå™¨"><a class="header-anchor" href="#äºŒã€æ‹¦æˆªå™¨" aria-hidden="true">#</a> äºŒã€æ‹¦æˆªå™¨</h2><p>Array åŸå‹ä¸­å¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„æ–¹æ³•æœ‰ 7 ä¸ªï¼Œåˆ†åˆ«æ˜¯ pushã€popã€shiftã€unshiftã€spliceã€sort å’Œ reverseã€‚</p><div class="language-jsx"><pre><code><span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>

<span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;shift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;unshift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;splice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sort&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;reverse&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å…ˆåˆ›å»ºå˜é‡ arrayMethods ç»§æ‰¿è‡ª Array.prototypeï¼Œå…·å¤‡å…¶æ‰€æœ‰åŠŸèƒ½ï¼Œåé¢è¦ä½¿ç”¨ arrayMethods å»è¦†ç›– Array.prototypeã€‚</p><p>æ¥ä¸‹æ¥åœ¨ arrayMethods ä¸Šä½¿ç”¨ Object.defineProperty æ–¹æ³•å°†é‚£äº›å¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«çš„æ–¹æ³•è¿›è¡Œå°è£…ã€‚</p><p>å½“æ‰§è¡Œæ•°ç»„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ mutator å‡½æ•°ã€‚</p><h2 id="ä¸‰ã€ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–-array-åŸå‹"><a class="header-anchor" href="#ä¸‰ã€ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–-array-åŸå‹" aria-hidden="true">#</a> ä¸‰ã€ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›– Array åŸå‹</h2><p>æˆ‘ä»¬ä¸èƒ½ç›´æ¥å»è¦†ç›–å…¨å±€çš„ Arrayï¼Œå› ä¸ºè¿™æ ·ä¼šæ±¡æŸ“åˆ°å¥¹ã€‚æˆ‘ä»¬å¸Œæœ›æ‹¦æˆªæ“ä½œåªæ˜¯é’ˆå¯¹é‚£äº›è¢«ä¾¦æµ‹äº†çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‹¦æˆªå™¨åªè¦†ç›–é‚£äº›å“åº”å¼æ•°ç»„çš„åŸå‹ã€‚ å°†ä¸€ä¸ªæ•°æ®è½¬æ¢ä¸ºå“åº”å¼çš„ï¼Œéœ€è¦é€šè¿‡ Observerï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–é‚£äº›å³å°†è¢«è½¬æ¢æˆå“åº”å¼ Array ç±»å‹æ•°æ®çš„åŸå‹å°±å¯ä»¥äº†ã€‚</p><div class="language-jsx"><pre><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value

    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			value<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> arrayMethods <span class="token comment">// æ–°å¢</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> 
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-jsx"><pre><code>value<span class="token punctuation">.</span>__<span class="token operator">**</span>proto__<span class="token operator">**</span> <span class="token operator">=</span> arrayMethods
</code></pre></div><p>è¿™å¥ä»£ç çš„ä½œç”¨æ˜¯å°†æ‹¦æˆªå™¨ï¼ˆåŠ å·¥åå…·å¤‡æ‹¦æˆªåŠŸèƒ½çš„ arrayMethodsï¼‰èµ‹å€¼ç»™ value.<strong>proto</strong>ï¼Œé€šè¿‡ <strong>proto</strong> å®ç°è¦†ç›– value åŸå‹çš„åŠŸèƒ½ã€‚</p><h2 id="å››ã€å°†æ‹¦æˆªå™¨æ–¹æ³•æŒ‚è½½åˆ°æ•°ç»„çš„å±æ€§ä¸Š"><a class="header-anchor" href="#å››ã€å°†æ‹¦æˆªå™¨æ–¹æ³•æŒ‚è½½åˆ°æ•°ç»„çš„å±æ€§ä¸Š" aria-hidden="true">#</a> å››ã€å°†æ‹¦æˆªå™¨æ–¹æ³•æŒ‚è½½åˆ°æ•°ç»„çš„å±æ€§ä¸Š</h2><p>å½“æµè§ˆå™¨ä¸èƒ½ä½¿ç”¨ <strong>proto</strong> æ—¶ï¼ŒVue çš„åšæ³•æ˜¯ç›´æ¥å°† arrayMethods ä¸Šçš„æ–¹æ³•è®¾ç½®åˆ°è¢«ä¾¦æµ‹çš„æ•°ç»„ä¸Šï¼Œä¹Ÿå°±æ˜¯å°†å·²ç»åŠ å·¥äº†æ‹¦æˆªæ“ä½œçš„åŸå‹æ–¹æ³•ç›´æ¥æ·»åŠ åˆ° value çš„å±æ€§ä¸­ã€‚</p><h2 id="äº”ã€å¦‚ä½•æ”¶é›†ä¾èµ–"><a class="header-anchor" href="#äº”ã€å¦‚ä½•æ”¶é›†ä¾èµ–" aria-hidden="true">#</a> äº”ã€å¦‚ä½•æ”¶é›†ä¾èµ–</h2><p>åœ¨å¯¹è±¡ä¸­ï¼Œæ˜¯åœ¨ getter ä¸­æ”¶é›†ä¾èµ–ï¼Œä¾èµ–è¢«å­˜å‚¨åœ¨ Dep é‡Œã€‚Array å’Œ Object ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨ defineReactive ä¸­æ”¶é›†ä¾èµ–ã€‚Object åœ¨ setter ä¸­è§¦å‘ä¾èµ–ï¼Œè€Œ Array åœ¨æ‹¦æˆªå™¨ä¸­è§¦å‘ä¾èµ–ã€‚</p><h2 id="å…­ã€ä¾èµ–åˆ—è¡¨å­˜åœ¨å“ªå„¿"><a class="header-anchor" href="#å…­ã€ä¾èµ–åˆ—è¡¨å­˜åœ¨å“ªå„¿" aria-hidden="true">#</a> å…­ã€ä¾èµ–åˆ—è¡¨å­˜åœ¨å“ªå„¿</h2><p>Vue.js æŠŠ Array çš„ä¾èµ–å­˜æ”¾åœ¨ Observer ä¸­ï¼š</p><div class="language-jsx"><pre><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ–°å¢ dep</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> augment <span class="token operator">=</span> hasProto <span class="token operator">?</span> protoAugment <span class="token operator">:</span> copyAugment
      <span class="token function">augment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä¸ºä»€ä¹ˆæ•°ç»„çš„ä¾èµ–æ”¾ Observer ä¸­ï¼Ÿ æ˜¯å› ä¸ºåœ¨ getter ä¸­å¯ä»¥è®¿é—®åˆ° Observer å®ä¾‹ï¼Œåœ¨ Array æ‹¦æˆªå™¨ä¸­ä¹Ÿå¯ä»¥è®¿é—®åˆ° Observer å®ä¾‹ã€‚</p></blockquote><h2 id="ä¸ƒã€æ”¶é›†ä¾èµ–"><a class="header-anchor" href="#ä¸ƒã€æ”¶é›†ä¾èµ–" aria-hidden="true">#</a> ä¸ƒã€æ”¶é›†ä¾èµ–</h2><p>æŠŠ Dep å®ä¾‹ä¿å­˜åœ¨ Observer çš„å±æ€§ä¸Šä¹‹åï¼Œå¯ä»¥åœ¨ getter ä¸­é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥è®¿é—®å¹¶æ”¶é›†ä¾èµ–ï¼š</p><div class="language-jsx"><pre><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// ä¿®æ”¹</span>
	<span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	Obejct<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token comment">// æ–°å¢</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>childOb<span class="token punctuation">)</span><span class="token punctuation">{</span>
				childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ”¶é›†ä¾èµ–</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> val
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span>
			dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			val <span class="token operator">=</span> newVal
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-jsx"><pre><code><span class="token comment">/**
	* å°è¯•ä¸º value åˆ›å»ºä¸€ä¸ª Observe å®ä¾‹
	* å¦‚æœåˆ›å»ºæˆåŠŸï¼Œç›´æ¥è¿”å›æ–°åˆ›å»ºçš„ Observe å®ä¾‹
	* å¦‚æœ value å·²ç»å­˜åœ¨ä¸€ä¸ª Observe å®ä¾‹ï¼Œåˆ™ç›´æ¥è¿”å›å®ƒ
	*/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> asRootData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token keyword">let</span> ob
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&#39;__ob__&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observe</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ob <span class="token operator">=</span> value<span class="token punctuation">.</span>__ob__
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ob
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡ observe æˆ‘ä»¬å¾—åˆ°äº†æ•°ç»„çš„ Observe å®ä¾‹ï¼ˆchildObï¼‰ï¼Œæœ€åé€šè¿‡ childOb çš„ dep æ‰§è¡Œ depend æ–¹æ³•æ¥æ”¶é›†ä¾èµ–ã€‚ä»è€Œå®ç°äº†æ•°ç»„åœ¨ getter ä¸­å°†ä¾èµ–æ”¶é›†åˆ° Observe å®ä¾‹çš„ dep ä¸­ã€‚</p><h2 id="å…«ã€åœ¨æ‹¦æˆªå™¨ä¸­è·å–-observer-å®ä¾‹"><a class="header-anchor" href="#å…«ã€åœ¨æ‹¦æˆªå™¨ä¸­è·å–-observer-å®ä¾‹" aria-hidden="true">#</a> å…«ã€åœ¨æ‹¦æˆªå™¨ä¸­è·å– Observer å®ä¾‹</h2><p>Array æ˜¯å¯¹åŸå‹çš„ä¸€ç§å°è£…ï¼Œæ‰€ä»¥å¯ä»¥å†æ‹¦æˆªå™¨ä¸­è®¿é—®åˆ° thisï¼ˆå½“å‰æ­£åœ¨æ“ä½œçš„æ•°ç»„ï¼‰ã€‚</p><p>è€Œä¾èµ–åˆ—è¡¨ dep ä¿å­˜åœ¨ Observer ä¸­ï¼Œæ‰€ä»¥éœ€è¦åœ¨ this ä¸Šè¯»åˆ° Observer çš„å®ä¾‹ï¼š</p><div class="language-jsx"><pre><code><span class="token comment">// å·¥å…·å‡½æ•°</span>
<span class="token keyword">function</span> <span class="token function">def</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">value</span><span class="token operator">:</span> val<span class="token punctuation">,</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumberable<span class="token punctuation">,</span>
		<span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&#39;__ob__&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// æ–°å¢</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> augment <span class="token operator">=</span> hasProto <span class="token operator">?</span> protoAugment <span class="token operator">:</span> copyAugment
      <span class="token function">augment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œdef å‡½æ•°è¡¨ç¤ºåœ¨ value ä¸Šæ–°å¢äº†ä¸€ä¸ªä¸å¯æšä¸¾çš„å±æ€§ &#39;<strong>ob</strong>&#39;ï¼Œè¿™ä¸ªå±æ€§çš„å€¼å°±æ˜¯å½“å‰ Observer çš„å®ä¾‹ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ•°ç»„æ•°æ®çš„ &#39;<strong>ob</strong>&#39; å±æ€§æ‹¿åˆ° Observer å®ä¾‹ï¼Œç„¶åæ‹¿åˆ°è¯¥å®ä¾‹çš„ &#39;<strong>ob</strong>&#39; ä¸Šçš„ dep ä¾èµ–åˆ—è¡¨ã€‚</p><blockquote><p><strong>ob</strong> çš„ä½œç”¨ä¹Ÿå¯ä»¥ç”¨æ¥æ ‡è®°å½“å‰ value æ˜¯å¦å·²ç»è¢« Observer è½¬æ¢æˆäº†å“åº”å¼æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰è¢«ä¾¦æµ‹äº†å˜åŒ–çš„æ•°æ®èº«ä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ª <strong>ob</strong> å±æ€§æ¥è¡¨ç¤ºå®ƒä»¬æ˜¯å“åº”å¼çš„ã€‚</p></blockquote><blockquote><p>value è¢«æ ‡è®°äº† <strong>ob</strong> ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡ value.<strong>ob</strong> æ¥è®¿é—® observer å®ä¾‹ï¼Œå¦‚æœæ˜¯Array æ‹¦æˆªå™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ this.<strong>ob</strong> æ¥è®¿é—® Observer å®ä¾‹ã€‚</p></blockquote><h2 id="ä¹ã€å‘æ•°ç»„çš„ä¾èµ–å‘é€é€šçŸ¥"><a class="header-anchor" href="#ä¹ã€å‘æ•°ç»„çš„ä¾èµ–å‘é€é€šçŸ¥" aria-hidden="true">#</a> ä¹ã€å‘æ•°ç»„çš„ä¾èµ–å‘é€é€šçŸ¥</h2><p>å½“ä¾¦æµ‹åˆ°æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå‘ä¾èµ–å‘é€é€šçŸ¥ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ Observer å®ä¾‹ä¸­æ‹¿åˆ° dep å±æ€§ï¼Œç„¶åç›´æ¥å‘é€é€šçŸ¥ï¼š</p><div class="language-jsx"><pre><code><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;shift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;unshift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;splice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sort&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;reverse&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
	<span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
			ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å‘ä¾èµ–å‘é€æ¶ˆæ¯</span>
			<span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="åã€ä¾¦æµ‹æ•°ç»„ä¸­å…ƒç´ çš„å˜åŒ–"><a class="header-anchor" href="#åã€ä¾¦æµ‹æ•°ç»„ä¸­å…ƒç´ çš„å˜åŒ–" aria-hidden="true">#</a> åã€ä¾¦æµ‹æ•°ç»„ä¸­å…ƒç´ çš„å˜åŒ–</h2><p>æˆ‘ä»¬éœ€è¦åœ¨ Observer ä¸­æ–°å¢ä¸€äº›å¤„ç†ï¼Œè®©å®ƒå¯ä»¥å°† Array ä¹Ÿè½¬æ¢æˆå“åº”å¼çš„ï¼š</p><div class="language-jsx"><pre><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&#39;__ob__&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¾¦æµ‹ Array ä¸­çš„æ¯ä¸€é¡¹</span>
<span class="token function">observeArray</span><span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>observe å‡½æ•°å°±æ˜¯å°†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ‰§è¡Œä¸€é new Observeã€‚</p><h2 id="åä¸€ã€ä¾¦æµ‹æ–°å¢å…ƒç´ çš„å˜åŒ–"><a class="header-anchor" href="#åä¸€ã€ä¾¦æµ‹æ–°å¢å…ƒç´ çš„å˜åŒ–" aria-hidden="true">#</a> åä¸€ã€ä¾¦æµ‹æ–°å¢å…ƒç´ çš„å˜åŒ–</h2><p>æ•°ç»„ä¸­æœ‰äº›æ–¹æ³•å¦‚ pushã€unshiftã€splice æ˜¯æ–°å¢å…ƒç´ çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–°å¢çš„å…ƒç´ ä¹Ÿè½¬æ¢æˆå“åº”å¼çš„æ¥ä¾¦æµ‹å˜åŒ–ã€‚</p><p>åªè¦è·å–æ–°å¢çš„å…ƒç´ ï¼Œç„¶åç”¨ Observer æ¥ä¾¦æµ‹å®ƒä»¬ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œè·å–æ–°å¢çš„å…ƒç´ ï¼š</p><div class="language-jsx"><pre><code><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;shift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;unshift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;splice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sort&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;reverse&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
	<span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
			<span class="token comment">// æ–°å¢</span>
			<span class="token keyword">let</span> inserted
			<span class="token keyword">switch</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token string">&#39;push&#39;</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token string">&#39;unshift&#39;</span><span class="token operator">:</span>
					inserted <span class="token operator">=</span> args
					<span class="token keyword">break</span>
				<span class="token keyword">case</span> <span class="token string">&#39;splice&#39;</span><span class="token operator">:</span>
					inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
					<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
			ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ Observer ä¾¦æµ‹æ–°å…ƒç´ </p><p>æˆ‘ä»¬çŸ¥é“ Observer ä¼šå°†è‡ªèº«çš„å®ä¾‹é™„åŠ åˆ° value çš„ <strong>ob</strong> å±æ€§ä¸Šã€‚æ‰€æœ‰è¢«ä¾¦æµ‹äº†å˜åŒ–çš„æ•°æ®éƒ½æœ‰ä¸€ä¸ª <strong>ob</strong> å±æ€§ï¼Œæ•°ç»„å…ƒç´ ä¹Ÿä¸ä¾‹å¤–ã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ‹¦æˆªå™¨ä¸­é€šè¿‡ this è®¿é—®åˆ° <strong>ob</strong>ï¼Œç„¶åè°ƒç”¨å…¶ä¸Šçš„ observeArray æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p><div class="language-jsx"><pre><code><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">&#39;push&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;shift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;unshift&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;splice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sort&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;reverse&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
	<span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
			<span class="token keyword">let</span> inserted
			<span class="token keyword">switch</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token string">&#39;push&#39;</span><span class="token operator">:</span>
				<span class="token keyword">case</span> <span class="token string">&#39;unshift&#39;</span><span class="token operator">:</span>
					inserted <span class="token operator">=</span> args
					<span class="token keyword">break</span>
				<span class="token keyword">case</span> <span class="token string">&#39;splice&#39;</span><span class="token operator">:</span>
					inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
					beeak
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token comment">// æ–°å¢</span>
			ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-"><pre><code>
## åäºŒã€å…³äº Array çš„é—®é¢˜

å¯¹ Array çš„å˜åŒ–ä¾¦æµ‹æ˜¯é€šè¿‡æ‹¦æˆªåŸå‹çš„æ–¹å¼å®ç°çš„ï¼Œæ‰€æœ‰æœ‰äº›åƒ this.list[0] = 2ï¼Œè¿™ç§å˜åŒ–æ˜¯ä¸ä¼šè¢«ä¾¦æµ‹åˆ°çš„ã€‚è¿˜æœ‰ this.list.length = 0

## åä¸‰ã€æ€»ç»“

- Array æ˜¯é€šè¿‡æ–¹æ³•æ¥æ”¹å˜å†…å®¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºæ‹¦æˆªå™¨å»è¦†ç›–æ•°ç»„åŸå‹çš„æ–¹å¼æ¥è¿½è¸ªå˜åŒ–ã€‚
- ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€çš„ Array.prototypeï¼Œæˆ‘ä»¬åœ¨ Observe ä¸­å€¼é’ˆå¯¹é‚£äº›éœ€è¦ä¾¦æµ‹å˜åŒ–çš„æ•°ç»„ä½¿ç”¨ __proto__ æ¥è¦†ç›–åŸå‹æ–¹æ³•ï¼Œä½† __proto__ ä¸æ˜¯æ ‡å‡†å±æ€§ï¼Œé’ˆå¯¹é‚£äº›ä¸æ”¯æŒè¿™ä¸ªå±æ€§çš„æµè§ˆå™¨ï¼Œä¼šç›´æ¥å¾ªç¯æ‹¦æˆªå™¨ï¼ŒæŠŠæ‹¦æˆªå™¨ä¸­çš„æ–¹æ³•ç›´æ¥è®¾ç½®åˆ°æ•°ç»„èº«ä¸Šæ¥æ‹¦æˆª Array.prototype ä¸Šçš„åŸç”Ÿæ–¹æ³•ã€‚
- Array æ”¶é›†ä¾èµ–çš„æ–¹å¼å’Œ Object ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ getter ä¸­æ”¶é›†ï¼Œä½†æ˜¯ç”±äºä¾èµ–çš„ä½ç½®ä¸åŒï¼Œæ•°ç»„è¦åœ¨æ‹¦æˆªå™¨ä¸­å‘ä¾èµ–å‘æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¾èµ–ä¸èƒ½åƒ Object ä¸€æ ·ä¿å­˜åœ¨ defineReactive ä¸­ï¼Œè€Œæ˜¯æŠŠä¾èµ–ä¿å­˜åœ¨äº† Observe å®ä¾‹ä¸Šã€‚
- åœ¨ Observe ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªä¾¦æµ‹äº†å˜åŒ–çš„æ•°æ®éƒ½æ ‡è®° __ob__ï¼Œå¹¶æŠŠ this ï¼ˆObserve å®ä¾‹ï¼‰ä¿å­˜åœ¨ __ob__ ä¸Šï¼Œæœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ–¹é¢æ˜¯æ ‡è®°æ•°æ®æ˜¯å¦è¢«ä¾¦æµ‹äº†å˜åŒ–ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä¸ºäº†ä¾¿äºé€šè¿‡æ•°æ®å–åˆ° __ob__ï¼Œä»è€Œæ‹¿åˆ° Observe å®ä¾‹ä¸Šä¿å­˜çš„ä¾èµ–ã€‚å½“æ‹¦æˆªåˆ°æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘ä¾èµ–å‘é€é€šçŸ¥ã€‚
- é™¤äº†ä¾¦æµ‹æ•°ç»„è‡ªèº«çš„å˜åŒ–ï¼Œæ•°ç»„ä¸­å…ƒç´ å‘ç”Ÿå˜åŒ–ä¹Ÿè¦è¢«ä¾¦æµ‹åˆ°ã€‚æˆ‘ä»¬åœ¨ Observe ä¸­åˆ¤æ–­å¦‚æœå½“å‰è¢«ä¾¦æµ‹çš„æ•°æ®æ˜¯æ•°ç»„ï¼Œåˆ™è°ƒç”¨ observeArray æ–¹æ³•å°†æ•°ç»„ä¸Šçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½è½¬æ¢æˆå“åº”å¼çš„å¹¶ä¾¦æµ‹å˜åŒ–ã€‚
- é™¤äº†ä¾¦æµ‹å·²æœ‰æ•°æ®ï¼Œå½“è°ƒç”¨pushã€unshiftã€spliceç­‰æ–¹æ³•å‘æ•°ç»„æ–°å¢å…ƒç´ æ—¶ï¼Œè¿™äº›å…ƒç´ ä¹Ÿè¦è¢«ä¾¦æµ‹åˆ°ã€‚æˆ‘ä»¬ä½¿ç”¨å½“å‰æ“ä½œæ•°ç»„çš„æ–¹æ³•æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯è¿™å‡ ä¸ªæ–¹æ³•ï¼Œåˆ™ä»å‚æ•°ä¸­å°†æ–°å¢æ•°æ®æå–å‡ºæ¥ï¼Œç„¶åä½¿ç”¨ observeArray æ–¹æ³•å¯¹æ–°å¢æ•°æ®è¿›è¡Œå˜åŒ–ä¾¦æµ‹ã€‚</code></pre></div></div><div class="links-wrapper"><div class="prev-link"><!----></div><div class="next-link"><!----></div></div><div><p class="platform"> Copyright Â© 2022-2023 <a href="https://github.com/jeamn">@Jeamn</a></p></div><!--[--><!--]--></div><!-- åªæƒ³ç‚¹å‡»èƒŒæ™¯æ‰å…³é—­ è¯·ä½¿ç”¨ .self ä¿®é¥°ç¬¦ --><div style="display:none;" class="imgBox"><img src=""></div><!--]--></main><div class="theme-select" data-v-4a5ae416><ul data-v-4a5ae416><li class="active" data-v-4a5ae416>â˜€ï¸</li><li class="" data-v-4a5ae416>ğŸŒ‘</li></ul></div></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"README.md\":\"74ba73cf\",\"index.md\":\"c2842757\",\"more_Friendship.md\":\"2ddbc272\",\"more_docs.md\":\"ac4de4a9\",\"more_index.md\":\"2f258ce2\",\"more_tags.md\":\"9c361e7d\",\"docs_algorithm_monotonic-stack.md\":\"06425485\",\"docs_browser_cookie.md\":\"8cbcb41a\",\"docs_browser_rendering.md\":\"8f638c6b\",\"docs_javascript_anti-shaking-and-throttling.md\":\"9af40163\",\"docs_javascript_bind.md\":\"0e4d9cea\",\"docs_javascript_closure.md\":\"9c603236\",\"docs_javascript_es6-Iterator.md\":\"942ac03c\",\"docs_javascript_es6-Promise.md\":\"56c7c057\",\"docs_javascript_es6-module.md\":\"0b7596e3\",\"docs_javascript_event-loop.md\":\"9969f462\",\"docs_javascript_inherit.md\":\"7889c76a\",\"docs_javascript_scope.md\":\"15bb219e\",\"docs_node_realize-require.md\":\"3830c2f9\",\"docs_vue_interview.md\":\"005b29bf\",\"docs_vue_vue-array-update.md\":\"041757dc\",\"docs_vue_vue-bind.md\":\"6fc818cf\",\"docs_vue_book_srqc-1.md\":\"e66ab639\",\"docs_vue_book_srqc-10.md\":\"b56c32c7\",\"docs_vue_book_srqc-2.md\":\"4e783021\",\"docs_vue_book_srqc-3.md\":\"028c7b9d\",\"docs_vue_book_srqc-4.md\":\"74007c18\",\"docs_vue_book_srqc-5.md\":\"d3152f32\",\"docs_vue_book_srqc-6.md\":\"f53289b5\",\"docs_vue_book_srqc-7.md\":\"b6d0a962\",\"docs_vue_book_srqc-8.md\":\"95cb9979\",\"docs_vue_book_srqc-9.md\":\"2a093e51\"}")</script>
    <script type="module" async src="/nirvana/_assets/app.963d3ba1.js"></script>
  </body>
</html>